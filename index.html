<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Stream</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{
    --primary:#007aff;
    --bg:#0a0a0c;
    --surface:#1c1c1e;
    --text:#fff;
    --text-dim: #a1a1a6;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif}
body{background:var(--bg);color:var(--text); padding-top: 10px; overflow-x: hidden;}

/* --- Internet Alert Style --- */
#offline-notice {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: #ff3b30;
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: 600;
    z-index: 10000;
    display: none;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
}

/* --- App Header --- */
.fixed-top {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg);
    z-index: 1000;
    border-bottom: 1px solid #1c1c1e;
}

header {
    padding: 15px 18px;
    display: flex;
    align-items: center;
    gap: 15px;
}
header h1 {
    color: var(--primary);
    font-size: 20px;
    letter-spacing: 1px;
}

.header-search {
    flex: 1;
    background: #1c1c1e;
    padding: 8px 15px;
    border-radius: 20px;
    display: flex;
    align-items: center;
}
.header-search input {
    background: transparent;
    border: none;
    outline: none;
    color: white;
    margin-left: 10px;
    width: 100%;
    font-size: 14px;
}

/* --- Info Button --- */
.info-btn {
    color: var(--text-dim);
    font-size: 20px;
    cursor: pointer;
    padding: 5px;
}

/* --- About Overlay (Your Original Design) --- */
#aboutOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg);
    z-index: 2000;
    display: none;
    overflow-y: auto;
}

.about-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
.card {
    background: var(--surface);
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 25px;
    border: 1px solid #2c2c2e;
}
.card h2 { font-size: 20px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; color: var(--primary); }
.author-info { display: flex; align-items: center; gap: 20px; }
.author-avatar { width: 70px; height: 70px; background: #2c2c2e; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; }
.author-details h3 { font-size: 18px; }
.author-details p { color: var(--text-dim); font-size: 14px; }
.github-link { display: inline-block; margin-top: 10px; color: var(--primary); text-decoration: none; font-weight: 600; }
.faq-item { margin-bottom: 15px; border-bottom: 1px solid #2c2c2e; padding-bottom: 10px; }
.faq-item strong { display: block; color: var(--text); margin-bottom: 5px; font-size: 15px; }
.faq-item p { color: var(--text-dim); font-size: 14px; }
.badge { background: #2c2c2e; padding: 4px 10px; border-radius: 5px; font-size: 12px; font-weight: 600; color: var(--primary); }
.back-btn { display: inline-block; margin-bottom: 20px; color: var(--text-dim); text-decoration: none; font-size: 14px; cursor: pointer; }

/* --- Video Section --- */
.video-section {
    max-width: 900px;
    margin: 0 auto;
    background: #000;
}

.player-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 16/9;
    background: #000;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.player-wrapper.force-landscape {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 100vh;
    height: 100vw;
    transform: translate(-50%, -50%) rotate(90deg);
    z-index: 9999;
    aspect-ratio: unset;
}

.video-placeholder {
    color: #666;
    font-size: 14px;
    text-align: center;
    position: absolute;
}

.loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;border:4px solid #333;border-top:4px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;display:none;z-index:5}
@keyframes spin{0%{transform:translate(-50%,-50%) rotate(0deg)}100%{transform:translate(-50%,-50%) rotate(360deg)}}
video{width:100%;height:100%;object-fit:contain; display: none;}

.controls{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:space-between;background:linear-gradient(to top,rgba(0,0,0,.7),transparent);opacity:0;visibility:hidden;transition:.3s;z-index:10}
.player-wrapper.active .controls{opacity:1;visibility:visible}

.top-controls{padding:15px; display: flex; justify-content: flex-start;}

.list-btn {
    display: none; 
    font-size:18px;
    color:white;
    background:rgba(0,0,0,0.5);
    padding:10px;
    border-radius:50%;
    cursor:pointer;
}
.player-wrapper.force-landscape .list-btn {
    display: block; 
}

.center-controls{flex:1;display:flex;align-items:center;justify-content:center;gap:30px;}
.center-controls i{color:white;background:rgba(0,0,0,.5);width:55px;height:55px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;}
.play{width:70px !important;height:70px !important;font-size:28px !important;}

.control-bar{display:flex;align-items:center;gap:20px;padding:15px}
.control-bar i{font-size:20px;}
.spacer{flex:1}

/* --- Overlay List --- */
.overlay-channel-list{position:absolute;top:0;left:0;width:280px;height:100%;background:rgba(10,10,12,0.98);z-index:20;transform:translateX(-100%);transition:0.3s;display:flex;flex-direction:column;padding:15px;border-right:1px solid #333}
.overlay-channel-list.active{transform:translateX(0)}
.overlay-items{overflow-y:auto;flex:1; margin-top: 10px;}

.overlay-search {
    background: #1c1c1e;
    padding: 8px 12px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}
.overlay-search input {
    background: transparent;
    border: none;
    outline: none;
    color: white;
    font-size: 13px;
    margin-left: 8px;
    width: 100%;
}

/* --- Main Container List --- */
.container {
    width: 95%;
    max-width: 600px;
    margin: 420px auto 20px;
}
@media (max-width: 600px) {
    .container { margin-top: 350px; }
}

.channel-item{
    background:var(--surface);
    padding:10px 12px;
    border-radius:10px;
    margin-bottom:8px;
    display:flex;
    align-items:center;
    gap:12px;
}
.channel-item.active-chan{border:1px solid var(--primary);background:#262629}
.channel-id{color:var(--primary);font-weight:700; min-width: 25px; font-size: 13px;}
.fav-icon { margin-left: auto; color: #444; font-size: 16px; }
.fav-icon.active { color: #ff3b30; }

.folder-item {
    background: #2c2c2e;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 8px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 14px;
}
.folder-item i.chevron { margin-left: auto; transition: transform 0.3s; }
.folder-item.open i.chevron { transform: rotate(180deg); }

.folder-content { 
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease-out, opacity 0.3s;
    opacity: 0;
    border-left: 2px solid var(--primary);
    padding-left: 5px;
}
.folder-content.show { max-height: 1000px; opacity: 1; margin-bottom: 10px; }
</style>
</head>
<body>

<div id="offline-notice"><i class="fas fa-wifi-slash"></i> No Internet Connection!</div>

<div id="aboutOverlay">
    <div class="about-container">
        <div class="back-btn" onclick="toggleAbout()"><i class="fas fa-arrow-left"></i> Back to App</div>

        <header style="text-align: center; margin-bottom: 50px;">
            <div style="font-size: 50px; color: var(--primary); margin-bottom: 10px;"><i class="fas fa-play-circle"></i></div>
            <h1>Stream</h1>
            <p style="color: var(--text-dim); font-size: 16px;">watch the world for free</p>
        </header>

        <div class="card">
            <h2><i class="fas fa-info-circle"></i> About the App</h2>
            <p style="color: var(--text-dim);">Stream is designed for seamless live television streaming. It supports M3U playlists and provides a high-performance video player with landscape mode support, favorites management, and an intuitive user interface.</p>
        </div>

        <div class="card">
            <h2><i class="fas fa-user-tie"></i> Developer Information</h2>
            <div class="author-info">
                <div class="author-avatar"><i class="fas fa-code"></i></div>
                <div class="author-details">
                    <h3>Abir</h3>
                    <p>A tech thirsty student</p>
                    <a href="https://github.com/abirhosenakram" class="github-link"><i class="fab fa-github"></i> Follow in Github</a>
                </div>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-question-circle"></i> Troubleshooting & FAQ</h2>
            <div class="faq-item">
                <strong>Stream not loading?</strong>
                <p>Ensure you have a stable internet connection. Some links might be geo-restricted or temporarily offline.</p>
            </div>
            <div class="faq-item">
                <strong>How to add to favorites?</strong>
                <p>Click the heart icon on any channel item. Your favorites will be saved locally on your device.</p>
            </div>
            <div class="faq-item">
                <strong>Video looks stretched?</strong>
                <p>Use the "Fit" button in the player controls to toggle between 'Contain' and 'Cover' modes.</p>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-balance-scale"></i> License & Copyright</h2>
            <p style="font-size: 14px; color: var(--text-dim);">
                This application is provided "as is" without warranty of any kind. 
                <br><br>
                <span class="badge">MIT LICENSE</span><br><br>
                Copyright © 2026 Stream. All rights reserved. The developer does not host any streaming content; all links are fetched from public repositories.
            </p>
        </div>

        <div style="text-align: center; color: var(--text-dim); font-size: 13px; margin-top: 50px;">
            Version 1.2.0 • Build with ❤️ for Streamers
        </div>
    </div>
</div>

<div class="fixed-top">
    <header>
        <h1>Stream</h1>
        <div class="header-search">
            <i class="fas fa-search" style="color:#666"></i>
            <input placeholder="Search channels..." onkeyup="filterChannels(this.value)">
        </div>
        <i class="fas fa-info-circle info-btn" onclick="toggleAbout()"></i>
    </header>

    <div class="video-section">
        <div class="player-wrapper" id="box">
            <div id="placeholderText" class="video-placeholder">Select a channel to start streaming</div>
            <div class="loader" id="loader"></div>
            <video id="video" playsinline></video>
            
            <div class="overlay-channel-list" id="overlay" onclick="event.stopPropagation()">
                <div class="overlay-search">
                    <i class="fas fa-search" style="color:#666; font-size: 12px;"></i>
                    <input placeholder="Search..." onkeyup="filterChannels(this.value)">
                </div>
                <div class="overlay-items" id="overlayContainer"></div>
            </div>

            <div class="controls">
                <div class="top-controls">
                    <i class="fas fa-list list-btn" onclick="toggleOverlay(event)"></i>
                </div>
                <div class="center-controls">
                    <i class="fas fa-backward-step" onclick="prevChannel(event)"></i>
                    <i class="fas fa-play play" id="playBtn" onclick="togglePlay(event)"></i>
                    <i class="fas fa-forward-step" onclick="nextChannel(event)"></i>
                </div>
                <div class="control-bar">
                    <div class="spacer"></div>
                    <i class="fas fa-expand-arrows-alt" id="fitBtn" onclick="toggleFit(event)"></i>
                    <i class="fas fa-expand" id="fullIcon" onclick="goFull(event)"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div id="mainContent"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.10/hls.min.js"></script>

<script>
const video = document.getElementById("video");
const box = document.getElementById("box");
const playBtn = document.getElementById("playBtn");
const fitBtn = document.getElementById("fitBtn");
const overlay = document.getElementById("overlay");
const loader = document.getElementById("loader");
const placeholderText = document.getElementById("placeholderText");
const offlineNotice = document.getElementById("offline-notice");

// রিফ্রেশ রিকভারি ডাটা
let currentIdx = parseInt(localStorage.getItem('savedChannelIdx')) || 0;
let controlTimer;
let isFill = false;
let isFavOpen = false; 
let channels = [];
let favorites = JSON.parse(localStorage.getItem('favChannels') || '[]');
let hls;

// ইন্টারনেট চেকার
function checkInternet() {
    if (navigator.onLine) {
        offlineNotice.style.display = "none";
    } else {
        offlineNotice.style.display = "block";
    }
}
window.addEventListener('online', checkInternet);
window.addEventListener('offline', checkInternet);

function toggleAbout() {
    const about = document.getElementById("aboutOverlay");
    if(about.style.display === "block") {
        about.style.display = "none";
        document.body.style.overflow = "auto";
    } else {
        about.style.display = "block";
        document.body.style.overflow = "hidden";
    }
}

async function fetchPlaylist(url){
    try{
        const res = await fetch(url);
        const data = await res.text();
        parseM3U(data);
        
        // রিফ্রেশ করলে যদি আগের চ্যানেল সেভ থাকে তবে সেটা অটো লোড হবে
        if(channels.length > 0 && localStorage.getItem('savedChannelIdx') !== null) {
            openChannel(currentIdx);
        }
    }catch(err){ 
        console.error("Error:", err);
        checkInternet();
    }
}

function parseM3U(data){
    const lines = data.split('\n').map(l=>l.trim()).filter(l=>l);
    let tempChannels=[];
    for(let i=0;i<lines.length;i++){
        if(lines[i].startsWith('#EXTINF:')){
            const logoMatch = lines[i].match(/tvg-logo="([^"]+)"/);
            const nameMatch = lines[i].match(/,(.+)/);
            const url = lines[i+1];
            tempChannels.push({
                name: nameMatch ? nameMatch[1] : "Unknown", 
                url: url, 
                logo: logoMatch ? logoMatch[1] : ""
            });
            i++;
        }
    }
    tempChannels.shift();
    channels = tempChannels.map((c, index) => ({...c, id: index + 1}));
    render();
}

function render(){
    const favList = channels.filter(c => favorites.includes(c.id));
    
    const generateHtml = () => {
        let html = '';
        if(favList.length > 0){
            html += `
                <div class="folder-item ${isFavOpen ? 'open' : ''}" onclick="toggleFavFolder()">
                    <i class="fas fa-heart" style="color:#ff3b30"></i> Favorites (${favList.length})
                    <i class="fas fa-chevron-down chevron"></i>
                </div>
                <div class="folder-content ${isFavOpen ? 'show' : ''}">
                    ${favList.map(c => renderItem(c)).join('')}
                </div>
            `;
        }
        html += channels.map(c => renderItem(c)).join('');
        return html;
    };

    document.getElementById("mainContent").innerHTML = generateHtml();
    document.getElementById("overlayContainer").innerHTML = generateHtml();
}

function renderItem(c){
    const idx = channels.findIndex(ch => ch.id === c.id);
    return `
        <div class="channel-item ${idx===currentIdx?'active-chan':''}" onclick="openChannel(${idx}, event)" data-name="${c.name.toLowerCase()}" data-id="${c.id}">
            <span class="channel-id">${c.id}</span>
            ${c.logo ? `<img src="${c.logo}" style="width:30px;height:18px;border-radius:2px;object-fit:cover">` : ''}
            <span style="font-size:13px; flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${c.name}</span>
            <i class="fas fa-heart fav-icon ${favorites.includes(c.id)?'active':''}" onclick="toggleFav(${c.id}, event)"></i>
        </div>
    `;
}

function toggleFavFolder() {
    isFavOpen = !isFavOpen;
    render(); 
}

function toggleFav(id, e){
    e.stopPropagation();
    favorites = favorites.includes(id) ? favorites.filter(f => f !== id) : [...favorites, id];
    localStorage.setItem('favChannels', JSON.stringify(favorites));
    render();
}

function openChannel(i, e){
    if(e) e.stopPropagation();
    if(!channels[i]) return;

    currentIdx = i;
    // রিফ্রেশ করার জন্য ইনডেক্স সেভ
    localStorage.setItem('savedChannelIdx', i);

    placeholderText.style.display = "none";
    video.style.display = "block";
    loader.style.display="block";

    if(hls){ hls.destroy(); }
    if(Hls.isSupported()){
        hls = new Hls();
        hls.loadSource(channels[i].url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, ()=>video.play().catch(()=>{}));
    } else {
        video.src = channels[i].url;
        video.play().catch(()=>{});
    }
    playBtn.className="fas fa-pause play";
    render();
}

video.onplaying=()=> loader.style.display="none";
video.onwaiting=()=> loader.style.display="block";

function togglePlay(e){ 
    e.stopPropagation(); 
    if(video.paused){ video.play(); playBtn.className="fas fa-pause play"; } 
    else { video.pause(); playBtn.className="fas fa-play play"; }
}

function nextChannel(e){ if(e) e.stopPropagation(); currentIdx=(currentIdx+1)%channels.length; openChannel(currentIdx);}
function prevChannel(e){ if(e) e.stopPropagation(); currentIdx=(currentIdx-1+channels.length)%channels.length; openChannel(currentIdx);}

async function goFull(e){
    e.stopPropagation();
    const isNowFull = box.classList.contains("force-landscape");
    if(!isNowFull){
        box.classList.add("force-landscape");
        document.getElementById("fullIcon").className = "fas fa-compress";
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape').catch(() => {});
        }
    } else {
        box.classList.remove("force-landscape");
        overlay.classList.remove("active"); 
        document.getElementById("fullIcon").className = "fas fa-expand";
        if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
        }
    }
}

function toggleOverlay(e){
    e.stopPropagation();
    overlay.classList.toggle("active");
}

function toggleFit(e){
    e.stopPropagation(); 
    isFill=!isFill; 
    video.style.objectFit=isFill?"cover":"contain"; 
    fitBtn.className=isFill?"fas fa-compress-arrows-alt":"fas fa-expand-arrows-alt";
}

box.addEventListener("click",()=>{
    if(overlay.classList.contains("active")) { 
        overlay.classList.remove("active"); 
        return; 
    }
    box.classList.toggle("active");
    clearTimeout(controlTimer);
    if(box.classList.contains("active")) controlTimer=setTimeout(()=>box.classList.remove("active"),3000);
});

function filterChannels(q){
    const searchTerm = q.toLowerCase();
    const allItems = document.querySelectorAll(".channel-item");
    allItems.forEach(item => {
        const name = item.dataset.name;
        const id = item.dataset.id;
        const match = name.includes(searchTerm) || id.includes(searchTerm);
        item.style.display = match ? "flex" : "none";
    });
}

// প্রারম্ভিক চেক
checkInternet();
fetchPlaylist("https://raw.githubusercontent.com/FunctionError/PiratesTv/main/combined_playlist.m3u");
</script>
</body>
</html>
